# FC SAN

## FC 拓扑结构

![image-20220627100212357](./fc.assets/image-20220627100212357.png)

​		FC主要有三种拓扑结构，用以描述各个节点的连接方式。光纤通道术语中的“节点” 是指通过网络进行通信的任何实体，而不一定是一个硬件节点。这个节点通常是一个设备， 比如说一个磁盘存储器，服务器上的一个主机总线适配器或者是一个光纤网交换机。

- 点到点式
  - 两个设备背对背直接连接。这是最简单的一种拓扑，连接能力受限。 
- 仲裁环式 
  - 这种设计方式中，所有设备连接在一个类似于令牌环的环路上。这个环路中添加或者移 除一个设备会导致环路上所有活动中断。一个设备的故障导致整个环路不能进行工作。光纤通道集线器能够用于将众多设备连接到一起形成一个逻辑上的环路，并且能够旁路故障 节点，使得环上节点的故障不会影响整个环路的通信。一个环路也可以通过使用线缆直接 将节点一个接一个的连接成一个环而实现。最小的环路只包含两个节点，这种结构看起来 和点到点式连接近似，它们的区别在很大程度上取决于各自的协议。
- 光纤交换式
	- 所有的设备或者设备环都被连接到光纤网交换机上，与现有的以太网的实现形式在概念 上是类似的。这种拓扑结构相对于点到点和仲裁环的优势在于：
		- 交换机对结构形式进行管理，提供了最好的互联形式。
		- 多对节点可以同时通信。
		- 各个节点的故障是孤立的，不会危及其他节点的工作。

## FC 交换机端口

![image-20220627104546686](./fc.assets/image-20220627104546686.png)

光纤网交换机中具有一些称为端口（Port）的连接部件，不同的端口根据其所连接的设 备类型，所起到的作用是不同的。光纤通道标准定义了以下端口：

- F_Port
  - F端口也被称为光纤网端口，用于将服务器和存储设备连接到交换机上。一个被连接到 交换机F端口的设备就是一个节点（Node），用光纤通道术语来说，它被看作是一个N端 口（N_Port）。如果是在仲裁环路拓扑结构中，则被称为NL端口（NL_Port）。交换机通过特定的N端口或者是NL端口名称来识别这些光纤通道节点

- E_Port
  - E端口也被称为扩展端口，被用于进行交换机之间的连接

- FL_Port
  - FC交换机的一个交换端口可以作为环路的组成部分，数据可以从交换机中传输到环上。 在环路环境下正常工作的一个交换端口称之为 FL_port

- G_Port：通用端口G端口
  - G端口是一种通用的端口，根据具体的实现方案，可以作为F端口或是E端口使用，也就 意味着G端口实际上可以被用作两种端口功能的组合。 由于G端口的自适应性， 在进行 FC-SAN的多交换机配置环境时，G端口为交换机提供了更好的灵活性并降低了每个端口 所耗费的管理成本

## FC HBA 卡 WWN

FC HBA的WWN具有两种类型： 
- WWNN（World Wide Node Name） 

	全球唯一节点名字，由光纤通道进行映射的分配给每一个上层节点一个全球惟一的64 位标识符，一个HBA上的所有端口共享一个WWNN。在计算机处理中，一个WWNN被分 配给一个接入到光纤网中的节点（一个端点， 如，一个设备）。WWNN可以被一个或者 多个不同的端口（每个端口拥有不同的WWPN，并且属于同一个节点）共同使用。

- WWPN（World Wide Port Name） 

	全球惟一端口名字， 分配给每一个光纤通道端口的全球惟一的64 位标示符， 每个 WWPN被该端口独享。WWPN在存储区域网络中的应用就等同于MAC地址在以太网协议 中的应用。
	
## FC 交换机 Zone 概念

- Zone 是可进行互通的端口或设备的名称构成的集合
- 在一个 zone 里的设备只能与同一个 zone 中的其他设备通信
- 一个设备可以同时在多个 zone 里

![image-20220627104049097](./fc.assets/image-20220627104049097.png)

- Basic Zones:（基本分区）
  - 设置基本分区，控制各设备或端口之间的访问权限
- Traffic Isolation Zones：（流量隔离分区）
  - 当存在多条 ISL 级联链路（多个E_Port）时，用于指定某条 ISL 链路只负责传送与该链路 E_Port 在同一Zone内的端口的流量

## FC 交换机 Zone 基本配置（Web）

![image-20220627163215625](./fc.assets/image-20220627163215625.png)

###  端口绑定

#### 1. 设置 Ailas

将服务器 db1 db2 和存储 ds8700 节点设置别名：

![db1](./fc.assets/db1.png)

![db2](./fc.assets/db2.png)

![ds8700](./fc.assets/ds8700.png)

#### 2. 创建 zone

![db01_zone](./fc.assets/db01_zone.png)

![db02_zone](./fc.assets/db02_zone.png)

#### 3. 创建配置并保存激活

![image-20220627164716089](./fc.assets/image-20220627164716089.png)

### WWNs 绑定



## FC 交换机 Zone 基本配置（CLI）

